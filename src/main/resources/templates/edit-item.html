<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Edit Item</title>

    <link rel="stylesheet" th:href="@{/css/base.css}"/>
    <link rel="stylesheet" th:href="@{/css/forms.css}"/>
    <link rel="stylesheet" th:href="@{/css/cards.css}"/>
    <link rel="stylesheet" th:href="@{/css/nav.css}"/>
    <link rel="stylesheet" th:href="@{/css/footer.css}"/>
</head>
<body>

<div th:replace="~{fragments/navbar :: navbar}"></div>

<main class="page-container edit-item-page">

    <header class="page-header" style="max-width:1050px;margin:1rem auto 1.25rem;display:flex;align-items:center;justify-content:space-between;gap:1rem;">
        <h1 style="margin:0;font-weight:800;color:#2C2F6B;">Edit Item</h1>
        <div class="page-header-actions" style="display:flex;gap:.5rem;">
            <a th:href="@{/collections/{collectionId}(collectionId=${collectionId})}" class="btn">Cancel</a>
        </div>
    </header>

    <section class="form-card" style="max-width:1050px;margin:0 auto 2rem;">
        <form th:action="@{/collections/{collectionId}/items/{itemId}/edit(collectionId=${collectionId}, itemId=${itemId})}"
              method="post"
              enctype="multipart/form-data"
              th:object="${createItemForm}">

            <div class="form-field">
                <label for="itemName">Item Name</label>
                <input id="itemName" type="text" th:field="*{itemName}" required/>
            </div>

            <div class="form-field">
                <label for="description">Description</label>
                <textarea id="description" th:field="*{description}" rows="4" placeholder="Optional"></textarea>
            </div>

            <div class="form-field">
                <label for="tagNames">Tags (comma-separated)</label>
                <input id="tagNames" type="text" th:field="*{tagNames}" placeholder="e.g. retro, boxed, sealed"/>
            </div>

            <div class="form-field">
                <label for="images">Upload more images</label>
                <input id="images" type="file" th:field="*{images}" accept="image/*" multiple/>
            </div>

            <div class="form-actions" style="display:flex;gap:.5rem;justify-content:flex-start;margin-top:1rem;">
                <button type="submit" class="btn btn-primary">Update Item</button>
                <a th:href="@{/collections/{collectionId}(collectionId=${collectionId})}" class="btn">Cancel</a>
            </div>
        </form>
    </section>

    <section style="max-width:1050px;margin:0 auto 3rem;">
        <h2 class="section-title" style="font-weight:800;color:#2C2F6B;margin:0 0 .75rem;">Existing Images</h2>

        <p class="muted" th:if="${existingImages == null or #lists.isEmpty(existingImages)}">No images yet.</p>

        <div class="thumb-grid"
             th:if="${existingImages != null and !#lists.isEmpty(existingImages)}"
             style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:1rem;">
            <div class="card thumb-card" th:each="image : ${existingImages}"
                 style="border-radius:16px;border:1px solid #ECEEF3;background:#fff;padding:.75rem;box-shadow:0 6px 22px rgba(24,32,56,0.06);display:flex;flex-direction:column;gap:.5rem;">
                <div style="border-radius:10px;overflow:hidden;background:#F2F4F7;aspect-ratio:1/1;">
                    <img th:src="@{'/uploads/images/' + ${image.fileName}}"
                         th:alt="${image.imageTitle != null && !#strings.isEmpty(image.imageTitle) ? image.imageTitle : image.fileName}"
                         style="width:100%;height:100%;object-fit:cover;display:block;"/>
                </div>

                <div class="thumb-title"
                     th:text="${image.imageTitle != null && !#strings.isEmpty(image.imageTitle) ? image.imageTitle : image.fileName}"
                     style="font-weight:700;color:#2C2F6B;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
                    Image Title
                </div>

                <form th:action="@{/collections/{collectionId}/items/{itemId}/images/{imageId}/delete(
                        collectionId=${collectionId}, itemId=${itemId}, imageId=${image.id})}"
                      method="post"
                      onsubmit="return confirm('Delete this image?');"
                      style="margin-top:.25rem;">
                    <button type="submit" class="btn btn-danger" style="width:100%;">Delete</button>
                </form>
            </div>
        </div>
    </section>

</main>

<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
